<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Development Environment • ryha</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Development Environment">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">ryha</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/data/data.html">Data</a></li>
    <li><a class="dropdown-item" href="../../articles/dev-environment/dev-environment.html">Development Environment</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Development Environment</h1>
            
      

      <div class="d-none name"><code>dev-environment.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><a href="https://github.com/COHHIO/ryha/tree/master/.devcontainer" class="external-link">.devcontainer</a>
directory contains the necessary files to set up a <a href="https://code.visualstudio.com/docs/devcontainers/containers" class="external-link">development
container</a>:</p>
<ul>
<li>
<a href="https://github.com/COHHIO/ryha/tree/master/.devcontainer/.env.example" class="external-link">.env.example</a>
is an <em>example</em> file that shows how to set the
<code>RENV_PATHS_CACHE_HOST</code> environment variable (required to
configure <a href="https://rstudio.github.io/renv/" class="external-link">renv</a>’s cache) based upon Windows OS.
<strong>You need to create a file named</strong> <code>.env</code>
<strong>in the same directory as</strong> <code>.env.example</code>
<strong>and set</strong> <code>RENV_PATHS_CACHE_HOST</code>
<strong>value to a path in your local machine based upon</strong> <a href="https://rstudio.github.io/renv/articles/package-install.html?q=cache%20location#cache-location" class="external-link">{renv}’s
Cache location</a>.</li>
<li>
<a href="https://github.com/COHHIO/ryha/tree/master/.devcontainer/complete_dev_setup.R" class="external-link">complete_dev_setup.R</a>
is a script run as a <code>postCreateCommand</code> in
<code>devcontainer.json</code> to leverage <a href="https://rstudio.github.io/renv/" class="external-link">renv</a>’s cache.
It performs the following tasks:
<ul>
<li>runs <code>renv::restore()</code> to restore the project’s
dependencies from the <a href="https://github.com/COHHIO/ryha/tree/master/renv.lock" class="external-link">renv.lock</a>
file</li>
<li>installs development-only packages (i.e. packages not needed to run
the application but useful during development, such as
<code>devtools</code>). <strong>You can add or remove development-only
packages from this script based on your preferences</strong>. It’s
recommended to specify exact package versions to prevent unintended
updates to other packages.</li>
<li>configures <a href="https://github.com/REditorSupport/languageserver" class="external-link">R Language
Server</a> by updating the <code>R_LIBS_USER</code> environment
variable, ensuring it points to the correct library path</li>
</ul>
</li>
<li>
<a href="https://github.com/COHHIO/ryha/tree/master/.devcontainer/devcontainer.json" class="external-link">devcontainer.json</a>
describes how VS Code should start the container and what to do after it
connects.</li>
<li>
<a href="https://github.com/COHHIO/ryha/tree/master/.devcontainer/docker-compose.yml" class="external-link">docker-compose.yml</a>
sets up a development environment with three services:
<ul>
<li>
<code>app</code>: a custom-built application container that mounts
local directories and <a href="https://kodekloud.com/blog/keep-docker-container-running/" class="external-link">runs
indefinitely</a>.</li>
<li>
<code>db</code>: a PostgreSQL database container with <a href="https://docs.docker.com/get-started/docker-concepts/running-containers/persisting-container-data/" class="external-link">persistent
storage</a> and <a href="https://stackoverflow.com/questions/52567272/docker-compose-postgres-expose-port" class="external-link">exposed
ports for access</a>. Check <a href="#db">db</a> section for
instructions on how to connect to, populate and launch the application
connected to the database.</li>
<li>
<code>pgadmin</code>: a <a href="https://www.pgadmin.org/" class="external-link">pgAdmin</a> container for database
management. Check <a href="#pgadmin">pgadmin</a> section for
instructions on how to configure the server.</li>
</ul>
</li>
<li>
<a href="https://github.com/COHHIO/ryha/tree/master/.devcontainer/Dockerfile.Dev" class="external-link">Dockerfile.Dev</a>
contains a set of instructions on how to build the Docker image to run
the application in development. <strong>Any new system requirement
needed for additional R packages installed must be added to this
file</strong>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<ul>
<li>
<a href="https://docs.docker.com/engine/install/" class="external-link">Docker</a>. We
recommend installing it via <a href="https://docs.docker.com/desktop/install/windows-install/" class="external-link">Docker
Desktop</a>.</li>
<li><a href="https://code.visualstudio.com/" class="external-link">VS Code</a></li>
<li>VS Code’s <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers" class="external-link">Dev
Container Extension</a>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="quickstart">QuickStart<a class="anchor" aria-label="anchor" href="#quickstart"></a>
</h2>
<p>Once you have installed the necessary requirements, cloned the
repository locally and created the <code>.devcontainer/.env</code> file,
open the repository in VSCode and click <strong>Reopen in
Container…</strong>:</p>
<p><img src="quickstart/reopen-in-container.png"></p>
<p><em>NOTE</em>: Alternatively, you can select <strong>Dev Containers:
Reopen in Container</strong> from the Command Palette (<code>F1</code>)
to perform this action.</p>
<p>The Dev Container initialization may take a few minutes, as it needs
to create different Docker images and install the corresponding R
packages via <code>renv::restore()</code>.</p>
<p>The following messages in <code>TERMINAL</code> tab indicate that the
process completed successfully:</p>
<p><img src="quickstart/finish.png"></p>
<p>Follow the instructions to configure R Language Server:</p>
<p><img src="quickstart/reload-window.png"></p>
<p><em>NOTE</em>: <strong>Developer: Reload Window</strong> only needs
to be run after a <strong>Rebuild</strong>. There is no need to run it
after you <strong>Reopen</strong> a container.</p>
<p><em>NOTE</em>: If you encounter any errors, you can review the logs
to troubleshoot or contact a team member for assistance.</p>
<p>To launch an R Terminal, select <strong>R: Create R terminal</strong>
from the Command Palette (<code>F1</code>). Alternatively, you can click
the <code>⌄</code> icon in VS Code Panel and select <strong>R
Terminal</strong>:</p>
<p><img src="quickstart/open-r.png"></p>
<p>Remember to select the R Terminal in the right sidebar to open
it.</p>
</div>
<div class="section level2">
<h2 id="clean-environment">Clean Environment<a class="anchor" aria-label="anchor" href="#clean-environment"></a>
</h2>
<div class="section level3">
<h3 id="exit-dev-container">Exit Dev Container<a class="anchor" aria-label="anchor" href="#exit-dev-container"></a>
</h3>
<p>To exit the Dev Container, click <strong>Dev Container</strong>
(bottom left corner) and select one of the following commands:</p>
<ul>
<li>
<strong>Reopen Folder Locally</strong>: This option will close the
current Dev Container session and reopen the project folder in your
local environment, outside of the containerized setup. It’s useful when
you want to switch back to your local development environment while
keeping the same project open.</li>
<li>
<strong>Close Remote Connection</strong>: This will close the
connection to the Dev Container and stop the container. The current
workspace will be closed, and you’ll be returned to the main VS Code
window without any active workspace or connection.</li>
</ul>
<p><img src="clean/exit-container.png"></p>
</div>
<div class="section level3">
<h3 id="remove-dev-container">Remove Dev Container<a class="anchor" aria-label="anchor" href="#remove-dev-container"></a>
</h3>
<p><em>NOTE</em>: If you work on the project on a regular basis, it’s
not <em>necessary</em> to remove the Dev Container after you exit
it.</p>
<p>To remove the Dev Container:</p>
<ol style="list-style-type: decimal">
<li><a href="#exit-dev-container">Exit the Dev Container</a></li>
<li>Remove the container</li>
<li>Remove associated images</li>
<li>Remove associated volumes</li>
</ol>
<p><strong>Warning</strong>: Removing the volumes will delete the
development database and any data you’ve uploaded, requiring you to
repopulate the database after rebuilding. If you choose to delete
<strong>only</strong> the container and its associated images (i.e. you
don’t delete the volumes), the development database will be available
when you rebuild the Dev Container.</p>
<p>The following steps demonstrate how to remove the container, images
and volumes using Docker Desktop. You can also use Docker’s command-line
interface to perform the same tasks.</p>
<div class="section level4">
<h4 id="remove-container">Remove Container<a class="anchor" aria-label="anchor" href="#remove-container"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Go to Containers tab</li>
<li>Locate the container associated with your Dev Container and click
the corresponding trash icon to stop and delete it</li>
</ol>
<p><img src="clean/delete-container.png"></p>
</div>
<div class="section level4">
<h4 id="remove-images">Remove Images<a class="anchor" aria-label="anchor" href="#remove-images"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Go to Images tab</li>
<li>Locate the images associated with your Dev Container and click the
corresponding trash icons to remove them from your local Docker
repository</li>
</ol>
<p><img src="clean/delete-images.png"></p>
</div>
<div class="section level4">
<h4 id="remove-volumes">Remove Volumes<a class="anchor" aria-label="anchor" href="#remove-volumes"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Go to Volumes tab</li>
<li>Search for <code>ryha</code>
</li>
<li>Select the associated volumes</li>
<li>Click <strong>Delete</strong>
</li>
</ol>
<p><img src="clean/delete-volumes.png"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="container-details">Container Details<a class="anchor" aria-label="anchor" href="#container-details"></a>
</h2>
<p>The container uses <a href="https://docs.docker.com/compose/" class="external-link">Docker
Compose</a> to initialize the following <strong>services</strong>:</p>
<div class="section level3">
<h3 id="app">app<a class="anchor" aria-label="anchor" href="#app"></a>
</h3>
<p><strong>app</strong> creates a container based on <a href="https://github.com/COHHIO/ryha/tree/master/.devcontainer/Dockerfile.Dev" class="external-link">.devcontainer/Dockerfile.Dev</a>.
This file:</p>
<ul>
<li>installs the R version used in this project</li>
<li>installs R packages’ system requirements</li>
<li>installs the <a href="https://rstudio.github.io/renv/" class="external-link">renv</a> version used in this project</li>
</ul>
<p>In addition, <strong>app</strong> service defines a <a href="https://docs.docker.com/storage/volumes/" class="external-link">Volume</a> to leverage
the use of <a href="https://rstudio.github.io/renv/" class="external-link">renv</a> cache. The
<code>RENV_PATHS_CACHE_HOST</code> environmental variable needs to be
set in <code>.devcontainer/.env</code>. Resources:</p>
<ul>
<li>
<a href="https://rstudio.github.io/renv/articles/package-install.html?q=cache%20location#cache-location" class="external-link">{renv}’s
Cache location</a>. This article helps to find where
<a href="https://rstudio.github.io/renv/" class="external-link">renv</a>’s cache is located in your machine.</li>
<li>
<a href="https://github.com/docker/for-win/issues/2151#issuecomment-662343075" class="external-link">This
GitHub Issue comment</a> shows examples on how to state the path when
working with a Windows machine.</li>
</ul>
<p>By setting the <code>network_mode</code> property to
<code>service:db</code>, we can use <code>host = "localhost"</code> when
connecting to the development database from inside the Dev Container.
This configuration ensures that the connection string remains the same
regardless of whether we are connecting from inside or outside the Dev
Container (when the <code>ports</code> property is set for
<code>db</code> service). Without <code>network_mode</code> setting, we
would need to use <code>host = "db"</code>, resulting in different
connection strings depending on the context, which is something we want
to avoid.</p>
<p>To run the app in development mode (without installing the {ryha} R
package), run <code><a href="https://thinkr-open.github.io/golem/reference/run_dev.html" class="external-link">golem::run_dev()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="db">db<a class="anchor" aria-label="anchor" href="#db"></a>
</h3>
<p><strong>db</strong> creates a postgreSQL database. You can find the
credentials under <code>db</code>’s <code>environment</code> property in
<a href="https://github.com/COHHIO/ryha/tree/master/.devcontainer/docker-compose.yml" class="external-link">.devcontainer/docker-compose.yml</a>.</p>
<p>The <code>ports</code> property allows the database to be accessible
in the host machine (i.e., outside of the Dev Container). With this
property set, the connection string will use
<code>host = "localhost"</code> for external access.</p>
<p>This configuration ensures that the connection string remains the
same regardless of whether we are connecting from outside or inside the
Dev Container (when the <code>network_mode</code> property is set for
<code>app</code> service).</p>
<div class="section level4">
<h4 id="connect">Connect<a class="anchor" aria-label="anchor" href="#connect"></a>
</h4>
<p>You can connect to the development database using the following
code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Connect to dev database</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span></span>
<span>    drv <span class="op">=</span> <span class="fu">RPostgres</span><span class="fu">::</span><span class="fu"><a href="https://rpostgres.r-dbi.org/reference/Postgres.html" class="external-link">Postgres</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    dbname <span class="op">=</span> <span class="st">"ryha-dev"</span>,</span>
<span>    host <span class="op">=</span> <span class="st">"localhost"</span>,</span>
<span>    port <span class="op">=</span> <span class="fl">5432</span>,</span>
<span>    user <span class="op">=</span> <span class="st">"ryha-dev"</span>,</span>
<span>    password <span class="op">=</span> <span class="st">"ryha"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="populate">Populate<a class="anchor" aria-label="anchor" href="#populate"></a>
</h4>
<p>Once the container is created, you can run <a href="https://github.com/COHHIO/ryha/tree/master/postgres/populate_dev_database/populate_dev_database.R" class="external-link">postgres/populate_dev_database/populate_dev_database.R</a>
to create and populate the corresponding tables. To run this script you
need to:</p>
<ul>
<li>Store <code>dm.rds</code> in the directory
<code>postgres/populate_dev_database/data</code>. <code>dm.rds</code> is
a snapshot of the database in production. It needs to be created by
someone with access to the production database. The process to generate
this object is to read each table in the database into a list of
dataframes where each element is named after the table name the data was
read from.</li>
<li>Run <code>devtools::load_all(".")</code> to have access to the
different functions in <code>ryha</code> that are used in the script
(e.g. <code><a href="../../reference/send_to_db.html">send_to_db()</a></code>).</li>
</ul>
</div>
<div class="section level4">
<h4 id="use-in-app">Use in App<a class="anchor" aria-label="anchor" href="#use-in-app"></a>
</h4>
<p>Once the container is running, you can set the environmental variable
<code>APP_BACKEND</code> to <code>dev</code> in <code>.Renviron</code>
to run the application connected to the development database.</p>
</div>
</div>
<div class="section level3">
<h3 id="pgadmin">pgAdmin<a class="anchor" aria-label="anchor" href="#pgadmin"></a>
</h3>
<p><strong>pgAdmin</strong> provides a graphical administration tool to
make it easier to manipulate schema and data in PostgreSQL. Once the
container is created, you can access pgAdmin in <a href="http://localhost:5050/" class="external-link uri">http://localhost:5050/</a>
with the following credentials (which are defined under
<code>pgadmin</code>’s <code>environment</code> property in
<code>.devcontainer/docker-compose.yml</code>):</p>
<ul>
<li>User: <code>admin@secret.io</code>
</li>
<li>Password: <code>admin</code>
</li>
</ul>
<p><em>NOTE</em>: pgAdmin may not function correctly in all web
browsers. We recommend using Google Chrome.</p>
<p>Once logged in, follow these steps to Register the Server:</p>
<ol style="list-style-type: decimal">
<li>Go to <code>Object &gt; Register &gt; Server...</code>.
Alternatively, you can right-click <code>Servers</code> as shown
below:</li>
</ol>
<p><img src="pgadmin/01.png"></p>
<ol start="2" style="list-style-type: decimal">
<li>In <code>General</code>, provide a <code>Name</code> for the server.
For example: <code>dev-db</code>.</li>
</ol>
<p><img src="pgadmin/02.png"></p>
<ol start="3" style="list-style-type: decimal">
<li>In <code>Connection</code>, set the following configuration:</li>
</ol>
<ul>
<li>Host name/address: <code>db</code>. This value needs to match the
<strong>service</strong> name.</li>
<li>Port: <code>5432</code>
</li>
<li>Maintenance database: <code>ryha-dev</code>
</li>
<li>Username: <code>ryha-dev</code>
</li>
<li>Password: <code>ryha</code>
</li>
</ul>
<p>Maintenance database, Username and Password were defined under
<code>db</code>’s <code>environment</code> property in
<code>.devcontainer/docker-compose.yml</code>.</p>
<p><img src="pgadmin/03.png"></p>
<ol start="4" style="list-style-type: decimal">
<li>Click <code>Save</code>. If the development database was already
populated, you should be able to see the tables with data:</li>
</ol>
<p><img src="pgadmin/04.png"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ketchbrook Analytics, Trevin Flickinger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
